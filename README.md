# brave-search-agent

This repository contains the backend and a basic frontend for an AI-powered search agent that leverages Brave Search API (and Google Custom Search Engine for web search), Ollama for local LLM inference, and custom tools for enhanced search and planning capabilities.

## Features

-   **Intelligent AI Search (`search` endpoint):**
    -   Uses a Langchain agent (`optimized_langchain_agent.py`) powered by Ollama to perform web searches, extract content, and find interesting links.
    -   Integrates with Brave Search for images and news, and Google Custom Search Engine (CSE) for general web search.
    -   Supports streaming responses for a dynamic user experience.
    -   Can integrate newly generated images and screenshots into the final formatted output via a layout-focused LLM.
-   **Advanced AI Planning (`plan` endpoint):**
    -   Utilizes a dedicated Planner Agent (`planner_agent.py`) with specialized tools (`planner_tools.py`) for complex tasks.
    -   Tools include: weather forecasting, route planning (using OpenRouteService), fetching operational details of places (simulated via web search), and generating Google Calendar event links.
    -   Employs LLM-driven guidance profiles (e.g., "TravelPlanning", "ShoppingComparison") to inform planning strategy.
    -   Provides structured HTML output for comprehensive plans.
-   **Conversation Management:**
    -   Securely stores and manages chat history in `conversations.json` with concurrency-safe atomic writes using `portalocker`.
    -   Supports creating, renaming, deleting, and reordering conversations.
-   **Image & Screenshot Management:**
    -   Automatically saves images from image search tools and screenshots from web page visits to `images/` and `screenshots/` directories respectively.
    -   Endpoints for listing, serving, and deleting these files.
-   **Frontend Playground (`FrontendPlayground/`):**
    -   A React + Vite application that provides a user interface to interact with the backend API.
    -   Features a chat interface with streaming responses, conversation history management, and a toggle for "Planning Mode".
    -   Visually enhances HTML responses generated by the LayoutChat component.

## Architecture Overview

The system is composed of several key Python modules and a React frontend:

-   `api.py`: Flask application that exposes RESTful endpoints for search, planning, and conversation management. It orchestrates calls to the AI agents and manages file I/O for conversation history and media.
-   `optimized_langchain_agent.py`: Implements the core search logic using Langchain, integrating with Ollama (for the main LLM) and various web search tools. It includes a `run_layout` method to pass results to `layout_chat.py`.
-   `planner_agent.py`: Implements the planning logic, also using Langchain and Ollama, but with a different set of specialized tools focused on structured data retrieval and task planning.
-   `tools.py`: Defines the tools available to the `OptimizedLangchainAgent`, such as `general_web_search`, `extended_web_search`, `news_search`, `weather_search`, `extract_web_content`, and `image_search`. Includes Playwright for screenshots and Brave Search API integration.
-   `planner_tools.py`: Defines the specialized tools for the `PlannerAgent`, including `get_weather_forecast_daily`, `plan_route_ors`, `get_operational_details`, and `add_calendar_event`. It also reuses `general_web_search` as a fallback.
-   `brave_search_api.py`: Handles direct API interactions with Brave Search and Google Custom Search Engine.
-   `layout_chat.py`: A crucial component that takes raw agent output and optional images/screenshots, then uses a vision-capable Ollama model to format it into visually appealing HTML.
-   `config.py`: (Assumed to exist, but not provided in snippets) Stores configuration variables like Ollama model names, API keys, and directory paths.
-   `conversations.json`: (Generated at runtime) Stores chat history for persistence.
-   `images/` and `screenshots/`: Directories for storing downloaded images and web page screenshots.
-   `FrontendPlayground/`: Contains the React frontend application.

## Setup and Installation

### Prerequisites

1.  **Python 3.9+**: Ensure you have Python installed.
2.  **Ollama**: Download and run Ollama from [ollama.ai](https://ollama.ai/).
3.  **Brave Search API Key**: Obtain a key from [brave.com/search/api](https://brave.com/search/api).
4.  **Google Custom Search Engine (CSE) API Key & CX ID**:
    -   Go to [Google Cloud Console](https://console.cloud.google.com/).
    -   Create a new project.
    -   Enable the "Custom Search API".
    -   Go to [Programmable Search Engine](https://programmablesearchengine.google.com/controlpanel/all) and create a new search engine. Link it to your entire web (`www.`) or specific sites. Note down the "Search engine ID" (CX ID).
    -   Create API credentials (API Key) for your project.
5.  **OpenWeatherMap API Key**: Obtain a key from [openweathermap.org](https://openweathermap.org/api).
6.  **OpenRouteService API Key**: Obtain a key from [openrouteservice.org](https://openrouteservice.org/).
7.  **Node.js & npm (for frontend)**: Ensure you have Node.js and npm installed.

### Backend Setup

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/rogerbaiges/brave-search-agent.git
    cd brave-search-agent
    ```
2.  **Create a virtual environment (recommended):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows: venv\Scripts\activate
    ```
3.  **Install Python dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

4. **Create a `config.py` file** in the root directory to add your models. Recommended ones are:
   ```
    MAIN_MODEL: str = "qwen2.5:7b"
    PLANNER_MODEL_NAME: str = "qwen3:8b"
    LAYOUT_MODEL: str = "gemma3:4b"
    VERBOSE: bool = True
    IMAGES_DIR: str = "FrontendPlayground/src/assets/images"
    SCREENSHOTS_DIR: str = "screenshots"
   ```
5.  **Create a `.env` file** in the root directory of the `brave-search-agent` project and add your API keys:
    ```
    BRAVE_API_KEY=
    OPEN_WEATHER_API_KEY=
    OPEN_ROUTE_SERVICE_API_KEY=
    
    GOOGLE_API_KEY=
    GOOGLE_CX_ID=
    ```
6.  **Pull Ollama models:**
    Ensure you have the specified models downloaded in Ollama.
7.  **Run the Flask backend:**
    ```bash
    python api.py
    ```
    The backend will run on `http://localhost:5000`.

### Frontend Setup

1.  **Navigate to the `FrontendPlayground` directory:**
    ```bash
    cd FrontendPlayground
    ```
2.  **Install Node.js dependencies:**
    ```bash
    npm i
    ```
3.  **Run the React development server:**
    ```bash
    npm run dev
    ```
    The frontend will typically open in your browser at `http://localhost:5173`.

## Usage

Once both the backend and frontend are running:

1.  Open your browser to the frontend address (e.g., `http://localhost:5173`).
2.  Type your query in the input box.
3.  Toggle the "Planning Mode" switch to enable/disable the specialized Planner Agent.
    -   **Search Mode (default):** Best for general information retrieval, summaries, finding links, and generating visually enhanced content.
    -   **Planning Mode:** Best for structured tasks like travel itineraries, event scheduling, and detailed comparisons that require multi-step reasoning and specific API calls (weather, routes, calendar).
4.  The conversation history will be saved and can be managed from the sidebar.

## Project Structure

```
.
├── README.md                 <-- This file
├── api.py                    # Flask backend application
├── brave_search_api.py       # Handles Brave Search and Google CSE API calls
├── config.py                 # (Assumed) Configuration variables (models, API keys, etc.)
├── conversations.json        # Persistent storage for chat history
├── layout_chat.py            # Post-processing LLM for HTML formatting
├── optimized_langchain_agent.py # Main search agent (Langchain + Ollama + Tools)
├── planner_agent.py          # Dedicated planning agent (Langchain + Ollama + Planner Tools)
├── planner_apis_example.py   # Example usage of planner-related APIs (not directly used by agent)
├── planner_tools.py          # Definitions for planner-specific tools
├── requirements.txt          # Python dependencies
├── tools.py                  # Definitions for general search tools
└── FrontendPlayground/       # React frontend application
    ├── public/
    ├── src/
    │   ├── App.jsx           # Main React component
    │   ├── main.jsx          # Entry point for React app
    │   └── components/ui/    # Reusable UI components (buttons, inputs, etc.)
    ├── .gitignore
    ├── eslint.config.js
    ├── index.html
    ├── package-lock.json
    ├── package.json
    ├── postcss.config.js
    ├── README.md
    ├── tailwind.config.js
    └── vite.config.js
```
